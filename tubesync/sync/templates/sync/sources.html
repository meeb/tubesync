{% extends 'base.html' %}

{% block headtitle %}Sources{% endblock %}

{% block content %}
<h1 class="truncate">Sources</h1>

{% include 'infobox.html' with message=message %}

<div class="mb-6">
  <a href="{% url 'sync:validate-source' %}" class="inline-flex items-center gap-2 px-4 py-2.5 rounded-md bg-primary text-primary-foreground font-medium text-sm hover:bg-accent hover:text-accent-foreground transition-colors">Add Source <i class="fab fa-youtube"></i></a>
</div>

<div class="divide-y divide-border rounded-lg border border-border overflow-hidden">
  {% for source in sources %}
    <div class="flex flex-col sm:flex-row sm:items-center gap-3 p-4 hover:bg-muted/50 transition-colors">
      <a href="{% url 'sync:source' pk=source.pk %}" class="flex-1 min-w-0">
        <div class="font-medium">{{ source.icon|safe }} <strong>{{ source.name }}</strong> <span class="text-muted-foreground">({{ source.get_source_type_display }} &quot;{{ source.key }}&quot;)</span></div>
        <div class="text-sm text-muted-foreground">{{ source.format_summary }}</div>
        {% if source.has_failed %}
        <div class="text-sm text-destructive"><i class="fas fa-exclamation-triangle"></i> <strong>Source has permanent failures</strong></div>
        {% else %}
        <div class="text-sm"><strong>{{ source.media_count }}</strong> media items, <strong>{{ source.downloaded_count }}</strong> downloaded{% if source.delete_old_media and source.days_to_keep > 0 %}, keeping {{ source.days_to_keep }} days of media{% endif %}</div>
        <div class="text-sm text-muted-foreground">Next update target: <strong class="text-foreground">{% if source.target_schedule %}{{ source.target_schedule|date:'l, h:00 A' }}{% else %}Not set{% endif %}</strong></div>
        {% endif %}
      </a>
      <a href="{% url 'sync:source-sync-now' pk=source.pk %}" class="inline-flex items-center justify-center px-4 py-2 rounded-md bg-primary text-primary-foreground font-medium text-sm hover:bg-accent hover:text-accent-foreground transition-colors whitespace-nowrap">Sync Now</a>
    </div>
  {% empty %}
    <div class="p-4 text-muted-foreground"><i class="fas fa-info-circle"></i> You haven't added any sources.</div>
  {% endfor %}
</div>

{% include 'pagination.html' with pagination=sources.paginator %}
{% endblock %}
