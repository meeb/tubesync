{% extends 'base.html' %}

{% block active_sources %} is-active{% endblock %}

{% block headtitle %}Sources{% endblock %}

{% block content %}
<div class="columns is-vcentered mb-4">
  <div class="column">
    <h1 class="title">Sources</h1>
  </div>
  <div class="column is-narrow">
    <a href="{% url 'sync:validate-source' %}" class="button is-primary">
      <span class="icon"><i class="fas fa-plus"></i></span>
      <span>Add Source</span>
    </a>
  </div>
</div>
{% include 'infobox.html' with message=message %}
<div class="columns">
  <div class="column is-12">
    {% for source in sources %}
      <div class="card mb-4">
        <div class="card-content">
          <div class="media">
            <div class="media-content">
              <h2 class="title is-5 mb-2">
                <span class="icon-text">
                  <span class="icon">{{ source.icon|safe }}</span>
                  <span>{{ source.name }}</span>
                </span>
              </h2>
              <p class="subtitle is-6 mb-2">
                {{ source.get_source_type_display }} "{{ source.key }}"
              </p>
              <div class="content is-small">
                <p class="mb-1">{{ source.format_summary }}</p>
                {% if source.has_failed %}
                <p class="has-text-danger mb-1">
                  <i class="fas fa-exclamation-triangle"></i> <strong>Source has permanent failures</strong>
                </p>
                {% else %}
                <p class="mb-1">
                  <strong>{{ source.media_count }}</strong> media items, <strong>{{ source.downloaded_count }}</strong> downloaded{% if source.delete_old_media and source.days_to_keep > 0 %}, keeping {{ source.days_to_keep }} days of media{% endif %}
                </p>
                <p class="mb-1">
                  Next update target: <strong>{% if source.target_schedule %}{{ source.target_schedule|date:'l, h:00 A' }}{% else %}Not set{% endif %}</strong>
                </p>
                {% endif %}
              </div>
            </div>
            <div class="media-right">
              <div class="buttons">
                <a href="{% url 'sync:source' pk=source.pk %}" class="button" title="View source details">
                  <span class="icon"><i class="fas fa-info-circle"></i></span>
                  <span>Details</span>
                </a>
                <a href="{% url 'sync:media' %}?filter={{ source.pk }}" class="button" title="View media">
                  <span class="icon"><i class="fas fa-film"></i></span>
                  <span>Media</span>
                </a>
                <a href="{% url 'sync:tasks-completed' %}?filter={{ source.pk }}" class="button" title="View tasks">
                  <span class="icon"><i class="far fa-clock"></i></span>
                  <span>Tasks</span>
                </a>
                <a href="{% url 'sync:update-source' pk=source.pk %}" class="button" title="Edit source">
                  <span class="icon"><i class="fas fa-pen-square"></i></span>
                  <span>Edit</span>
                </a>
                <a href="{% url 'sync:source-sync-now' pk=source.pk %}" class="button is-primary">
                  <span class="icon"><i class="fas fa-sync"></i></span>
                  <span>Sync Now</span>
                </a>
              </div>
            </div>
          </div>
        </div>
      </div>
    {% empty %}
      <div class="notification">
        <i class="fas fa-info-circle"></i> You haven't added any sources.
      </div>
    {% endfor %}
  </div>
</div>
{% include 'pagination.html' with pagination=sources.paginator %}
{% endblock %}
