{% extends 'base.html' %}

{% block headtitle %}Source - {{ source.name }}{% endblock %}

{% block content %}
<h1 class="title is-4">Source <strong>{{ source.name }}</strong></h1>
<p><strong><a href="{{ source.url }}" target="_blank"><i class="fas fa-link"></i> {{ source.url }}</a></strong></p>
<p class="mb-4">Saving to: <strong>{{ source.directory_path }}</strong></p>
<div class="buttons mb-4">
  <a href="{% url 'sync:media' %}?filter={{ source.pk }}" class="button is-primary">
    <span class="icon"><i class="fas fa-film"></i></span>
    <span>View media<span class="is-hidden-mobile"> linked to this source</span></span>
  </a>
  <a href="{% url 'sync:tasks-completed' %}?filter={{ source.pk }}" class="button is-primary">
    <span class="icon"><i class="far fa-clock"></i></span>
    <span>View tasks<span class="is-hidden-mobile"> linked to this source</span></span>
  </a>
</div>
{% include 'infobox.html' with message=message %}
{% if source.has_failed %}{% include 'errorbox.html' with message='This source has encountered permanent failures listed at the bottom of this page, check its settings' %}{% endif %}
<table class="table is-striped is-fullwidth">
  <tbody>
    <tr title="The source type">
      <td class="is-hidden-mobile">Type</td>
      <td><span class="is-hidden-tablet">Type<br></span><strong>{{ source.get_source_type_display }}</strong></td>
    </tr>
    <tr title="Name of the source in TubeSync for your reference">
      <td class="is-hidden-mobile">Name</td>
      <td><span class="is-hidden-tablet">Name<br></span><strong>{{ source.name }}</strong></td>
    </tr>
    <tr title="Number of media items downloaded for the source">
      <td class="is-hidden-mobile">Media items</td>
      <td><span class="is-hidden-tablet">Media items<br></span><strong><a href="{% url 'sync:media' %}?filter={{ source.pk }}">{{ media|length }}</a></strong></td>
    </tr>
    <tr title="Unique key of the source, such as the channel name or playlist ID">
      <td class="is-hidden-mobile">Key</td>
      <td><span class="is-hidden-tablet">Key<br></span><strong>{{ source.key }}</strong></td>
    </tr>
    <tr title="Directory the source will save media to">
      <td class="is-hidden-mobile">Directory</td>
      <td><span class="is-hidden-tablet">Directory<br></span><strong>{{ source.directory }}</strong></td>
    </tr>
    <tr title="Filter text">
      <td class="is-hidden-mobile">Filter text{% if source.filter_text_invert %} <em>Inverted</em>{% endif %}</td>
      <td><span class="is-hidden-tablet">Filter text{% if source.filter_text_invert %} <em>Inverted</em>{% endif %}<br></span>
        <strong>{{ source.filter_text }}</strong></td>
    </tr>
    {% if source.filter_seconds %}
    <tr title="Do not download videos shorter/longer than this limit seconds">
      <td class="is-hidden-mobile">Filter Seconds</td>
      <td><span class="is-hidden-tablet">Filter seconds<br>
      </span><strong>{{ source.filter_seconds }}s {% if source.filter_seconds_min %}(Minimum length){% else %}(Maximum Length){% endif %}</strong></td>
    </tr>
    {% endif %}
    <tr title="Media file name format to use for saving files">
      <td class="is-hidden-mobile">Media format</td>
      <td><span class="is-hidden-tablet">Media format<br></span><strong>{{ source.media_format }}</strong></td>
    </tr>
    <tr title="Example file name for media format">
      <td class="is-hidden-mobile">Example filename</td>
      <td><span class="is-hidden-tablet">Example filename<br></span><strong>{{ source.get_example_media_format }}</strong></td>
    </tr>
    {% if source.download_cap > 0 %}
    <tr title="Do not download videos older than this cap">
      <td class="is-hidden-mobile">Download cap</td>
      <td><span class="is-hidden-tablet">Download cap<br></span><strong>{{ source.get_download_cap_display }}</strong></td>
    </tr>
    {% endif %}
    <tr title="Schedule of how often to index the source for new media">
      <td class="is-hidden-mobile">Index schedule</td>
      <td><span class="is-hidden-tablet">Index schedule<br></span><strong>{{ source.get_index_schedule_display }}</strong></td>
    </tr>
    <tr title="Index videos from this source">
      <td class="is-hidden-mobile">Index videos?</td>
      <td><span class="is-hidden-tablet">Index videos?<br></span><strong>{% if source.index_videos %}<i class="fas fa-check"></i>{% else %}<i class="fas fa-times"></i>{% endif %}</strong></td>
    </tr>
    <tr title="Index streams from this source">
      <td class="is-hidden-mobile">Index streams?</td>
      <td><span class="is-hidden-tablet">Index streams?<br></span><strong>{% if source.index_streams %}<i class="fas fa-check"></i>{% else %}<i class="fas fa-times"></i>{% endif %}</strong></td>
    </tr>
    <tr title="Download media from this source">
      <td class="is-hidden-mobile">Download media?</td>
      <td><span class="is-hidden-tablet">Download media?<br></span><strong>{% if source.download_media %}<i class="fas fa-check"></i>{% else %}<i class="fas fa-times"></i>{% endif %}</strong></td>
    </tr>
    <tr title="When the source was created locally in TubeSync">
      <td class="is-hidden-mobile">Created</td>
      <td><span class="is-hidden-tablet">Created<br></span><strong>{{ source.created|date:'Y-m-d H:i:s' }}</strong></td>
    </tr>
    <tr title="When the source last checked for available media">
      <td class="is-hidden-mobile">Last crawl</td>
      <td><span class="is-hidden-tablet">Last crawl<br></span><strong>{% if source.last_crawl %}{{ source.last_crawl|date:'Y-m-d H:i:s' }}{% else %}Never{% endif %}</strong></td>
    </tr>
    <tr title="When the source should be next checked for available media">
      <td class="is-hidden-mobile">Target schedule</td>
      <td><span class="is-hidden-tablet">Target schedule<br></span><strong>{% if source.target_schedule %}{{ source.target_schedule|date:'l, h:00 A (c)' }}{% else %}Not set{% endif %}</strong></td>
    </tr>
    <tr title="Quality and type of media the source will attempt to sync">
      <td class="is-hidden-mobile">Source resolution</td>
      <td><span class="is-hidden-tablet">Source resolution<br></span><strong>{{ source.get_source_resolution_display }}</strong></td>
    </tr>
    {% if source.is_video %}
    <tr title="Preferred video codec to download">
      <td class="is-hidden-mobile">Source video codec</td>
      <td><span class="is-hidden-tablet">Source video codec<br></span><strong>{{ source.get_source_vcodec_display }}</strong></td>
    </tr>
    {% endif %}
    <tr title="Preferred audio codec to download">
      <td class="is-hidden-mobile">Source audio codec</td>
      <td><span class="is-hidden-tablet">Source audio codec<br></span><strong>{{ source.get_source_acodec_display }}</strong></td>
    </tr>
    <tr title="If available from the source media in 60FPS will be preferred">
      <td class="is-hidden-mobile">Prefer 60FPS?</td>
      <td><span class="is-hidden-tablet">Prefer 60FPS?<br></span><strong>{% if source.prefer_60fps %}<i class="fas fa-check"></i>{% else %}<i class="fas fa-times"></i>{% endif %}</strong></td>
    </tr>
    <tr title="If available from the source media in HDR will be preferred">
      <td class="is-hidden-mobile">Prefer HDR?</td>
      <td><span class="is-hidden-tablet">Prefer HDR?<br></span><strong>{% if source.prefer_hdr %}<i class="fas fa-check"></i>{% else %}<i class="fas fa-times"></i>{% endif %}</strong></td>
    </tr>
    <tr title="Output file extension">
      <td class="is-hidden-mobile">Output extension</td>
      <td><span class="is-hidden-tablet">Output extension<br></span><strong>{{ source.extension }}</strong></td>
    </tr>
    <tr title="What to do if your source resolution or codecs are unavailable">
      <td class="is-hidden-mobile">Fallback</td>
      <td><span class="is-hidden-tablet">Fallback<br></span><strong>{{ source.get_fallback_display }}</strong></td>
    </tr>
    <tr title="Should media thumbnails be copied over with the media?">
      <td class="is-hidden-mobile">Copy thumbnails?</td>
      <td><span class="is-hidden-tablet">Copy thumbnails?<br></span><strong>{% if source.copy_thumbnails %}<i class="fas fa-check"></i>{% else %}<i class="fas fa-times"></i>{% endif %}</strong></td>
    </tr>
    <tr title="Should an NFO file be written with the media?">
      <td class="is-hidden-mobile">Write NFO?</td>
      <td><span class="is-hidden-tablet">Write NFO?<br></span><strong>{% if source.write_nfo %}<i class="fas fa-check"></i>{% else %}<i class="fas fa-times"></i>{% endif %}</strong></td>
    </tr>
    <tr title="Should a JSON file be written with the media?">
      <td class="is-hidden-mobile">Write JSON?</td>
      <td><span class="is-hidden-tablet">Write JSON?<br></span><strong>{% if source.write_json %}<i class="fas fa-check"></i>{% else %}<i class="fas fa-times"></i>{% endif %}</strong></td>
    </tr>
    <tr title="Delete media that is no longer on this playlist?">
      <td class="is-hidden-mobile">Delete removed media</td>
      <td><span class="is-hidden-tablet">Delete removed media<br></span><strong>{% if source.delete_removed_media %}<i class="fas fa-check"></i>{% else %}<i class="fas fa-times"></i>{% endif %}</strong></td>
    </tr>
    <tr title="Delete files on disk when they are removed from TubeSync?">
      <td class="is-hidden-mobile">Delete files on disk</td>
      <td><span class="is-hidden-tablet">Delete files on disk<br></span><strong>{% if source.delete_files_on_disk %}<i class="fas fa-check"></i>{% else %}<i class="fas fa-times"></i>{% endif %}</strong></td>
    </tr>
    {% if source.delete_old_media and source.days_to_keep > 0 %}
    <tr title="Days after which your media from this source will be locally deleted">
      <td class="is-hidden-mobile">Delete old media</td>
      <td><span class="is-hidden-tablet">Delete old media<br></span><strong>After {{ source.days_to_keep }} days</strong></td>
    </tr>
    {% else %}
    <tr title="Media from this source will never be deleted">
      <td class="is-hidden-mobile">Delete old media</td>
      <td><span class="is-hidden-tablet">Delete old media<br></span><strong>No, keep forever</strong></td>
    </tr>
    {% endif %}
    <tr title="Unique ID used for this source in TubeSync">
      <td class="is-hidden-mobile">UUID</td>
      <td><span class="is-hidden-tablet">UUID<br></span><strong>{{ source.uuid }}</strong></td>
    </tr>
    <tr title="{{ _('Embedding thumbnail?') }}">
      <td class="is-hidden-mobile">{{ _("Embed thumbnail?") }}:</td>
      <td><span class="is-hidden-tablet">{{ _("Embed thumbnail?") }}<br></span><strong><i class="fas {% if source.embed_thumbnail %}fa-check{% else %}fa-times{% endif %}"></i></strong></td>
    </tr>
    <tr title="{{ _('Embedding metadata?') }}">
      <td class="is-hidden-mobile">{{ _("Embed metadata?") }}:</td>
      <td><span class="is-hidden-tablet">{{ _("Embed metadata?") }}<br></span><strong><i class="fas {% if source.embed_metadata %}fa-check{% else %}fa-times{% endif %}"></i></strong></td>
    </tr>
    <tr title="{{ _('Is sponsorblock enabled?') }}">
      <td class="is-hidden-mobile">{{ _("SponsorBlock?") }}:</td>
      <td><span class="is-hidden-tablet">{{ _("Sponsorblock enabled?") }}<br></span><strong><i class="fas {% if source.enable_sponsorblock %}fa-check{% else %}fa-times{% endif %}"></i></strong></td>
    </tr>
    {% if source.enable_sponsorblock %}
    <tr title="{{ _('SponsorBlock: What to block?') }}">
      <td class="is-hidden-mobile">{{ _("What blocked?") }}:</td>
      <td><span class="is-hidden-tablet">{{ _("What blocked?") }}<br></span><strong>
        {% if source.sponsorblock_categories.all_choice in source.sponsorblock_categories.selected_choices %}
          {% for k,v in source.sponsorblock_categories.possible_choices %}
            {{ v }}: <i class="fas fa-check"></i><br>
          {% endfor %}
        {% else %}
          {% for c in source.sponsorblock_categories.selected_choices %}
            {% for k,v in source.sponsorblock_categories.possible_choices %}
              {% if k == c %} {{ v }}: <i class="fas fa-check"></i><br>{% endif %}
            {% endfor %}
          {% endfor %}
        {% endif %}
      </strong></td>
    </tr>
    {% endif %}
    <tr title="{{ _('Are Subtitles downloaded?') }}">
      <td class="is-hidden-mobile">{{ _("Download subtitles?") }}:</td>
      <td><span class="is-hidden-tablet">{{ _("Download subtitles?") }}:</span><strong><i class="fas {% if source.write_subtitles %}fa-check{% else %}fa-times{% endif %}"></i></strong></td>
    </tr>
    {% if source.write_subtitles %}
    <tr title="{{ _('Are auto subs accepted?') }}">
      <td class="is-hidden-mobile">{{ _("Auto-generated subtitles?") }}:</td>
      <td><span class="is-hidden-tablet">{{ _("Auto-generated subtitles?") }}:</span><strong><i class="fas {% if source.auto_subtitles %}fa-check{% else %}fa-times{% endif %}"></i></strong></td>
    </tr>
    <tr title="{{ _('Subs langs?') }}">
      <td class="is-hidden-mobile">{{ _("Subs langs?") }}:</td>
      <td><span class="is-hidden-tablet">{{ _("Subs langs?") }}:</span><strong>{{source.sub_langs}}</strong></td>
    </tr>
    {% endif %}
  </tbody>
</table>
<div class="buttons pt-4">
  <a href="{% url 'sync:update-source' pk=source.pk %}" class="button is-primary">
    <span class="icon"><i class="fas fa-pen-square"></i></span>
    <span>Edit source</span>
  </a>
  <a href="{% url 'sync:delete-source' pk=source.pk %}" class="button is-danger">
    <span class="icon"><i class="fas fa-trash-alt"></i></span>
    <span>Delete source</span>
  </a>
</div>
{% if errors %}
<h2 class="title is-5 mt-5">Source has encountered {{ errors|length }} Error{{ errors|length|pluralize }}</h2>
<div class="box">
  {% for task in errors %}
  <div class="{% if not forloop.last %}mb-4{% endif %}">
    <span class="has-text-danger">
      <i class="fas fa-exclamation-triangle"></i> <strong>{{ task.verbose_name }}</strong><br>
      Error: "{{ task.error_message }}"<br>
      <i class="far fa-clock"></i> Occurred at <strong>{{ task.start_at|date:'Y-m-d H:i:s' }}</strong>
    </span>
  </div>
  {% endfor %}
</div>
{% endif %}
{% endblock %}
