{% extends 'base.html' %}

{% block headtitle %}Source - {{ source.name }}{% endblock %}

{% block content %}
<h1 class="truncate">Source <strong>{{ source.name }}</strong></h1>
<p class="truncate mb-1"><strong><a href="{{ source.url }}" target="_blank"><i class="fas fa-link"></i> {{ source.url }}</a></strong></p>
<p class="truncate text-muted-foreground mb-4">Saving to: <strong class="text-foreground">{{ source.directory_path }}</strong></p>

<div class="flex flex-col sm:flex-row gap-3 mb-6">
  <a href="{% url 'sync:media' %}?filter={{ source.pk }}" class="inline-flex items-center gap-2 px-4 py-2.5 rounded-md bg-primary text-primary-foreground font-medium text-sm hover:bg-accent hover:text-accent-foreground transition-colors">View media<span class="hidden sm:inline"> linked to this source</span> <i class="fas fa-fw fa-film"></i></a>
  <a href="{% url 'sync:tasks-completed' %}?filter={{ source.pk }}" class="inline-flex items-center gap-2 px-4 py-2.5 rounded-md bg-primary text-primary-foreground font-medium text-sm hover:bg-accent hover:text-accent-foreground transition-colors">View tasks<span class="hidden sm:inline"> linked to this source</span> <i class="far fa-fw fa-clock"></i></a>
</div>

{% include 'infobox.html' with message=message %}
{% if source.has_failed %}{% include 'errorbox.html' with message='This source has encountered permanent failures listed at the bottom of this page, check its settings' %}{% endif %}

<div class="rounded-lg border border-border overflow-hidden mb-6">
  <table class="w-full text-sm">
    <tr title="The source type" class="border-b border-border">
      <td class="hidden sm:table-cell py-3 px-4 text-muted-foreground font-medium w-1/3">Type</td>
      <td class="py-3 px-4"><span class="sm:hidden text-muted-foreground">Type<br></span><strong>{{ source.get_source_type_display }}</strong></td>
    </tr>
    <tr title="Name of the source in TubeSync for your reference" class="border-b border-border">
      <td class="hidden sm:table-cell py-3 px-4 text-muted-foreground font-medium w-1/3">Name</td>
      <td class="py-3 px-4"><span class="sm:hidden text-muted-foreground">Name<br></span><strong>{{ source.name }}</strong></td>
    </tr>
    <tr title="Number of media items downloaded for the source" class="border-b border-border">
      <td class="hidden sm:table-cell py-3 px-4 text-muted-foreground font-medium w-1/3">Media items</td>
      <td class="py-3 px-4"><span class="sm:hidden text-muted-foreground">Media items<br></span><strong><a href="{% url 'sync:media' %}?filter={{ source.pk }}">{{ media|length }}</a></strong></td>
    </tr>
    <tr title="Unique key of the source" class="border-b border-border">
      <td class="hidden sm:table-cell py-3 px-4 text-muted-foreground font-medium w-1/3">Key</td>
      <td class="py-3 px-4"><span class="sm:hidden text-muted-foreground">Key<br></span><strong>{{ source.key }}</strong></td>
    </tr>
    <tr title="Directory the source will save media to" class="border-b border-border">
      <td class="hidden sm:table-cell py-3 px-4 text-muted-foreground font-medium w-1/3">Directory</td>
      <td class="py-3 px-4"><span class="sm:hidden text-muted-foreground">Directory<br></span><strong>{{ source.directory }}</strong></td>
    </tr>
    <tr title="Filter text" class="border-b border-border">
      <td class="hidden sm:table-cell py-3 px-4 text-muted-foreground font-medium w-1/3">Filter text{% if source.filter_text_invert %} <em>Inverted</em>{% endif %}</td>
      <td class="py-3 px-4"><span class="sm:hidden text-muted-foreground">Filter text{% if source.filter_text_invert %} <em>Inverted</em>{% endif %}<br></span><strong>{{ source.filter_text }}</strong></td>
    </tr>
    {% if source.filter_seconds %}
    <tr title="Do not download videos shorter/longer than this limit seconds" class="border-b border-border">
      <td class="hidden sm:table-cell py-3 px-4 text-muted-foreground font-medium w-1/3">Filter Seconds</td>
      <td class="py-3 px-4"><span class="sm:hidden text-muted-foreground">Filter seconds<br></span><strong>{{ source.filter_seconds }}s {% if source.filter_seconds_min %}(Minimum length){% else %}(Maximum Length){% endif %}</strong></td>
    </tr>
    {% endif %}
    <tr title="Media file name format" class="border-b border-border">
      <td class="hidden sm:table-cell py-3 px-4 text-muted-foreground font-medium w-1/3">Media format</td>
      <td class="py-3 px-4"><span class="sm:hidden text-muted-foreground">Media format<br></span><strong>{{ source.media_format }}</strong></td>
    </tr>
    <tr title="Example file name" class="border-b border-border">
      <td class="hidden sm:table-cell py-3 px-4 text-muted-foreground font-medium w-1/3">Example filename</td>
      <td class="py-3 px-4"><span class="sm:hidden text-muted-foreground">Example filename<br></span><strong>{{ source.get_example_media_format }}</strong></td>
    </tr>
    {% if source.download_cap > 0 %}
    <tr title="Do not download videos older than this cap" class="border-b border-border">
      <td class="hidden sm:table-cell py-3 px-4 text-muted-foreground font-medium w-1/3">Download cap</td>
      <td class="py-3 px-4"><span class="sm:hidden text-muted-foreground">Download cap<br></span><strong>{{ source.get_download_cap_display }}</strong></td>
    </tr>
    {% endif %}
    <tr title="Index schedule" class="border-b border-border">
      <td class="hidden sm:table-cell py-3 px-4 text-muted-foreground font-medium w-1/3">Index schedule</td>
      <td class="py-3 px-4"><span class="sm:hidden text-muted-foreground">Index schedule<br></span><strong>{{ source.get_index_schedule_display }}</strong></td>
    </tr>
    <tr title="Index videos" class="border-b border-border">
      <td class="hidden sm:table-cell py-3 px-4 text-muted-foreground font-medium w-1/3">Index videos?</td>
      <td class="py-3 px-4"><span class="sm:hidden text-muted-foreground">Index videos?<br></span><strong>{% if source.index_videos %}<i class="fas fa-check text-green-600"></i>{% else %}<i class="fas fa-times text-destructive"></i>{% endif %}</strong></td>
    </tr>
    <tr title="Index streams" class="border-b border-border">
      <td class="hidden sm:table-cell py-3 px-4 text-muted-foreground font-medium w-1/3">Index streams?</td>
      <td class="py-3 px-4"><span class="sm:hidden text-muted-foreground">Index streams?<br></span><strong>{% if source.index_streams %}<i class="fas fa-check text-green-600"></i>{% else %}<i class="fas fa-times text-destructive"></i>{% endif %}</strong></td>
    </tr>
    <tr title="Download media" class="border-b border-border">
      <td class="hidden sm:table-cell py-3 px-4 text-muted-foreground font-medium w-1/3">Download media?</td>
      <td class="py-3 px-4"><span class="sm:hidden text-muted-foreground">Download media?<br></span><strong>{% if source.download_media %}<i class="fas fa-check text-green-600"></i>{% else %}<i class="fas fa-times text-destructive"></i>{% endif %}</strong></td>
    </tr>
    <tr title="Created" class="border-b border-border">
      <td class="hidden sm:table-cell py-3 px-4 text-muted-foreground font-medium w-1/3">Created</td>
      <td class="py-3 px-4"><span class="sm:hidden text-muted-foreground">Created<br></span><strong>{{ source.created|date:'Y-m-d H:i:s' }}</strong></td>
    </tr>
    <tr title="Last crawl" class="border-b border-border">
      <td class="hidden sm:table-cell py-3 px-4 text-muted-foreground font-medium w-1/3">Last crawl</td>
      <td class="py-3 px-4"><span class="sm:hidden text-muted-foreground">Last crawl<br></span><strong>{% if source.last_crawl %}{{ source.last_crawl|date:'Y-m-d H:i:s' }}{% else %}Never{% endif %}</strong></td>
    </tr>
    <tr title="Target schedule" class="border-b border-border">
      <td class="hidden sm:table-cell py-3 px-4 text-muted-foreground font-medium w-1/3">Target schedule</td>
      <td class="py-3 px-4"><span class="sm:hidden text-muted-foreground">Target schedule<br></span><strong>{% if source.target_schedule %}{{ source.target_schedule|date:'l, h:00 A (c)' }}{% else %}Not set{% endif %}</strong></td>
    </tr>
    <tr title="Source resolution" class="border-b border-border">
      <td class="hidden sm:table-cell py-3 px-4 text-muted-foreground font-medium w-1/3">Source resolution</td>
      <td class="py-3 px-4"><span class="sm:hidden text-muted-foreground">Source resolution<br></span><strong>{{ source.get_source_resolution_display }}</strong></td>
    </tr>
    {% if source.is_video %}
    <tr title="Preferred video codec" class="border-b border-border">
      <td class="hidden sm:table-cell py-3 px-4 text-muted-foreground font-medium w-1/3">Source video codec</td>
      <td class="py-3 px-4"><span class="sm:hidden text-muted-foreground">Source video codec<br></span><strong>{{ source.get_source_vcodec_display }}</strong></td>
    </tr>
    {% endif %}
    <tr title="Preferred audio codec" class="border-b border-border">
      <td class="hidden sm:table-cell py-3 px-4 text-muted-foreground font-medium w-1/3">Source audio codec</td>
      <td class="py-3 px-4"><span class="sm:hidden text-muted-foreground">Source audio codec<br></span><strong>{{ source.get_source_acodec_display }}</strong></td>
    </tr>
    <tr title="Prefer 60FPS" class="border-b border-border">
      <td class="hidden sm:table-cell py-3 px-4 text-muted-foreground font-medium w-1/3">Prefer 60FPS?</td>
      <td class="py-3 px-4"><span class="sm:hidden text-muted-foreground">Prefer 60FPS?<br></span><strong>{% if source.prefer_60fps %}<i class="fas fa-check text-green-600"></i>{% else %}<i class="fas fa-times text-destructive"></i>{% endif %}</strong></td>
    </tr>
    <tr title="Prefer HDR" class="border-b border-border">
      <td class="hidden sm:table-cell py-3 px-4 text-muted-foreground font-medium w-1/3">Prefer HDR?</td>
      <td class="py-3 px-4"><span class="sm:hidden text-muted-foreground">Prefer HDR?<br></span><strong>{% if source.prefer_hdr %}<i class="fas fa-check text-green-600"></i>{% else %}<i class="fas fa-times text-destructive"></i>{% endif %}</strong></td>
    </tr>
    <tr title="Output extension" class="border-b border-border">
      <td class="hidden sm:table-cell py-3 px-4 text-muted-foreground font-medium w-1/3">Output extension</td>
      <td class="py-3 px-4"><span class="sm:hidden text-muted-foreground">Output extension<br></span><strong>{{ source.extension }}</strong></td>
    </tr>
    <tr title="Fallback" class="border-b border-border">
      <td class="hidden sm:table-cell py-3 px-4 text-muted-foreground font-medium w-1/3">Fallback</td>
      <td class="py-3 px-4"><span class="sm:hidden text-muted-foreground">Fallback<br></span><strong>{{ source.get_fallback_display }}</strong></td>
    </tr>
    <tr title="Copy thumbnails" class="border-b border-border">
      <td class="hidden sm:table-cell py-3 px-4 text-muted-foreground font-medium w-1/3">Copy thumbnails?</td>
      <td class="py-3 px-4"><span class="sm:hidden text-muted-foreground">Copy thumbnails?<br></span><strong>{% if source.copy_thumbnails %}<i class="fas fa-check text-green-600"></i>{% else %}<i class="fas fa-times text-destructive"></i>{% endif %}</strong></td>
    </tr>
    <tr title="Write NFO" class="border-b border-border">
      <td class="hidden sm:table-cell py-3 px-4 text-muted-foreground font-medium w-1/3">Write NFO?</td>
      <td class="py-3 px-4"><span class="sm:hidden text-muted-foreground">Write NFO?<br></span><strong>{% if source.write_nfo %}<i class="fas fa-check text-green-600"></i>{% else %}<i class="fas fa-times text-destructive"></i>{% endif %}</strong></td>
    </tr>
    <tr title="Write JSON" class="border-b border-border">
      <td class="hidden sm:table-cell py-3 px-4 text-muted-foreground font-medium w-1/3">Write JSON?</td>
      <td class="py-3 px-4"><span class="sm:hidden text-muted-foreground">Write JSON?<br></span><strong>{% if source.write_json %}<i class="fas fa-check text-green-600"></i>{% else %}<i class="fas fa-times text-destructive"></i>{% endif %}</strong></td>
    </tr>
    <tr title="Delete removed media" class="border-b border-border">
      <td class="hidden sm:table-cell py-3 px-4 text-muted-foreground font-medium w-1/3">Delete removed media</td>
      <td class="py-3 px-4"><span class="sm:hidden text-muted-foreground">Delete removed media<br></span><strong>{% if source.delete_removed_media %}<i class="fas fa-check text-green-600"></i>{% else %}<i class="fas fa-times text-destructive"></i>{% endif %}</strong></td>
    </tr>
    <tr title="Delete files on disk" class="border-b border-border">
      <td class="hidden sm:table-cell py-3 px-4 text-muted-foreground font-medium w-1/3">Delete files on disk</td>
      <td class="py-3 px-4"><span class="sm:hidden text-muted-foreground">Delete files on disk<br></span><strong>{% if source.delete_files_on_disk %}<i class="fas fa-check text-green-600"></i>{% else %}<i class="fas fa-times text-destructive"></i>{% endif %}</strong></td>
    </tr>
    {% if source.delete_old_media and source.days_to_keep > 0 %}
    <tr title="Delete old media" class="border-b border-border">
      <td class="hidden sm:table-cell py-3 px-4 text-muted-foreground font-medium w-1/3">Delete old media</td>
      <td class="py-3 px-4"><span class="sm:hidden text-muted-foreground">Delete old media<br></span><strong>After {{ source.days_to_keep }} days</strong></td>
    </tr>
    {% else %}
    <tr title="Delete old media" class="border-b border-border">
      <td class="hidden sm:table-cell py-3 px-4 text-muted-foreground font-medium w-1/3">Delete old media</td>
      <td class="py-3 px-4"><span class="sm:hidden text-muted-foreground">Delete old media<br></span><strong>No, keep forever</strong></td>
    </tr>
    {% endif %}
    <tr title="UUID" class="border-b border-border">
      <td class="hidden sm:table-cell py-3 px-4 text-muted-foreground font-medium w-1/3">UUID</td>
      <td class="py-3 px-4"><span class="sm:hidden text-muted-foreground">UUID<br></span><strong>{{ source.uuid }}</strong></td>
    </tr>
    <tr title="{{ _('Embedding thumbnail?') }}" class="border-b border-border">
      <td class="hidden sm:table-cell py-3 px-4 text-muted-foreground font-medium w-1/3">{{ _("Embed thumbnail?") }}</td>
      <td class="py-3 px-4"><span class="sm:hidden text-muted-foreground">{{ _("Embed thumbnail?") }}<br></span><strong><i class="fas {% if source.embed_thumbnail %}fa-check text-green-600{% else %}fa-times text-destructive{% endif %}"></i></strong></td>
    </tr>
    <tr title="{{ _('Embedding metadata?') }}" class="border-b border-border">
      <td class="hidden sm:table-cell py-3 px-4 text-muted-foreground font-medium w-1/3">{{ _("Embed metadata?") }}</td>
      <td class="py-3 px-4"><span class="sm:hidden text-muted-foreground">{{ _("Embed metadata?") }}<br></span><strong><i class="fas {% if source.embed_metadata %}fa-check text-green-600{% else %}fa-times text-destructive{% endif %}"></i></strong></td>
    </tr>
    <tr title="{{ _('Is sponsorblock enabled?') }}" class="border-b border-border">
      <td class="hidden sm:table-cell py-3 px-4 text-muted-foreground font-medium w-1/3">{{ _("SponsorBlock?") }}</td>
      <td class="py-3 px-4"><span class="sm:hidden text-muted-foreground">{{ _("Sponsorblock enabled?") }}<br></span><strong><i class="fas {% if source.enable_sponsorblock %}fa-check text-green-600{% else %}fa-times text-destructive{% endif %}"></i></strong></td>
    </tr>
    {% if source.enable_sponsorblock %}
    <tr title="{{ _('SponsorBlock: What to block?') }}" class="border-b border-border">
      <td class="hidden sm:table-cell py-3 px-4 text-muted-foreground font-medium w-1/3">{{ _("What blocked?") }}</td>
      <td class="py-3 px-4"><span class="sm:hidden text-muted-foreground">{{ _("What blocked?") }}<br></span><strong>
        {% if source.sponsorblock_categories.all_choice in source.sponsorblock_categories.selected_choices %}
          {% for k,v in source.sponsorblock_categories.possible_choices %}
            {{ v }}: <i class="fas fa-check text-green-600"></i><br>
          {% endfor %}
        {% else %}
          {% for c in source.sponsorblock_categories.selected_choices %}
            {% for k,v in source.sponsorblock_categories.possible_choices %}
              {% if k == c %} {{ v }}: <i class="fas fa-check text-green-600"></i><br>{% endif %}
            {% endfor %}
          {% endfor %}
        {% endif %}
      </strong></td>
    </tr>
    {% endif %}
    <tr title="{{ _('Are Subtitles downloaded?') }}" class="border-b border-border">
      <td class="hidden sm:table-cell py-3 px-4 text-muted-foreground font-medium w-1/3">{{ _("Download subtitles?") }}</td>
      <td class="py-3 px-4"><span class="sm:hidden text-muted-foreground">{{ _("Download subtitles?") }}<br></span><strong><i class="fas {% if source.write_subtitles %}fa-check text-green-600{% else %}fa-times text-destructive{% endif %}"></i></strong></td>
    </tr>
    {% if source.write_subtitles %}
    <tr title="{{ _('Are auto subs accepted?') }}" class="border-b border-border">
      <td class="hidden sm:table-cell py-3 px-4 text-muted-foreground font-medium w-1/3">{{ _("Auto-generated subtitles?") }}</td>
      <td class="py-3 px-4"><span class="sm:hidden text-muted-foreground">{{ _("Auto-generated subtitles?") }}<br></span><strong><i class="fas {% if source.auto_subtitles %}fa-check text-green-600{% else %}fa-times text-destructive{% endif %}"></i></strong></td>
    </tr>
    <tr title="{{ _('Subs langs?') }}">
      <td class="hidden sm:table-cell py-3 px-4 text-muted-foreground font-medium w-1/3">{{ _("Subs langs?") }}</td>
      <td class="py-3 px-4"><span class="sm:hidden text-muted-foreground">{{ _("Subs langs?") }}<br></span><strong>{{source.sub_langs}}</strong></td>
    </tr>
    {% endif %}
  </table>
</div>

<div class="flex flex-col sm:flex-row gap-3 mb-6">
  <a href="{% url 'sync:update-source' pk=source.pk %}" class="inline-flex items-center gap-2 px-4 py-2.5 rounded-md bg-primary text-primary-foreground font-medium text-sm hover:bg-accent hover:text-accent-foreground transition-colors">Edit source <i class="fas fa-pen-square"></i></a>
  <a href="{% url 'sync:delete-source' pk=source.pk %}" class="inline-flex items-center gap-2 px-4 py-2.5 rounded-md bg-destructive text-destructive-foreground font-medium text-sm hover:bg-destructive/80 transition-colors">Delete source <i class="fas fa-trash-alt"></i></a>
</div>

{% if errors %}
<h2>Source has encountered {{ errors|length }} Error{{ errors|length|pluralize }}</h2>
<div class="divide-y divide-border rounded-lg border border-border overflow-hidden">
  {% for task in errors %}
    <div class="p-4 text-destructive">
      <i class="fas fa-exclamation-triangle"></i> <strong>{{ task.verbose_name }}</strong><br>
      Error: &quot;{{ task.error_message }}&quot;<br>
      <i class="far fa-clock"></i> Occured at <strong>{{ task.start_at|date:'Y-m-d H:i:s' }}</strong>
    </div>
  {% endfor %}
</div>
{% endif %}
{% endblock %}
