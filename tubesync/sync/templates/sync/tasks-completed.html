{% extends 'base.html' %}{% load filters %}

{% block headtitle %}Tasks - Completed{% endblock %}

{% block content %}
<h1 class="title mb-4">Completed tasks</h1>
{% include 'infobox.html' with message=message %}
<div class="box">
  {% for task in tasks %}
  <div class="box mb-4">
    <div class="mb-3">
      {% if task.has_error %}
      <span class="icon-text">
        <span class="icon has-text-danger"><i class="fas fa-exclamation-triangle"></i></span>
        <span><strong>{% if task.verbose_name %}{{ task.verbose_name }}{% else %}{{ task.name }}{% endif %}</strong></span>
      </span>
      {% if task.error_message %}
      <br>
      <small class="has-text-danger">{{ task.error_message }}</small>
      {% endif %}
      {% else %}
      <span class="icon-text">
        <span class="icon has-text-success"><i class="fas fa-check"></i></span>
        <span><strong>{% if task.verbose_name %}{{ task.verbose_name }}{% else %}{{ task.name }}{% endif %}</strong></span>
      </span>
      {% endif %}
    </div>
    <div class="columns is-mobile is-multiline has-text-grey">
      <div class="column is-half-mobile is-one-quarter-tablet">
        <strong>Queue:</strong> {{ task.queue }}
      </div>
      <div class="column is-half-mobile is-one-quarter-tablet">
        <strong>Duration:</strong> {{ task.end_at|sub:task.start_at|timedelta }}
      </div>
      <div class="column is-half-mobile is-one-quarter-tablet">
        <strong>Started:</strong> {{ task.start_at|date:'Y-m-d H:i:s' }}
      </div>
      <div class="column is-half-mobile is-one-quarter-tablet">
        <strong>Completed:</strong> {{ task.end_at|date:'Y-m-d H:i:s' }}
      </div>
    </div>
  </div>
  {% empty %}
  <div class="notification is-info is-light">
    <i class="fas fa-info-circle"></i> There have been no completed tasks{% if source %} that match the specified source filter{% endif %}.
  </div>
  {% endfor %}
</div>
{% include 'pagination.html' with filter=source.pk %}
{% endblock %}
