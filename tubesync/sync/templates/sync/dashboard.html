{% extends 'base.html' %}{% load humanize %}{% load filters %}

{% block headtitle %}Dashboard{% endblock %}

{% block content %}
<h1 class="truncate">Dashboard</h1>

{% if num_sources == 0 %}
<div class="mb-6">
  <p class="mb-3 text-muted-foreground">
    You don't have any media sources added. To get started, head over to the
    <a href="{% url 'sync:sources' %}">sources</a> page and add some.
  </p>
  <a href="{% url 'sync:sources' %}" class="inline-flex items-center gap-2 px-4 py-2.5 rounded-md bg-primary text-primary-foreground font-medium text-sm hover:bg-accent hover:text-accent-foreground transition-colors">Add a source <i class="fas fa-fw fa-play"></i></a>
</div>
{% endif %}

<!-- Stats cards -->
<div class="grid grid-cols-1 sm:grid-cols-2 xl:grid-cols-4 gap-4 mb-6">
  <a href="{% url 'sync:sources' %}" class="group rounded-lg border border-border bg-card p-5 text-center hover:border-accent transition-colors">
    <div class="text-3xl font-bold text-foreground truncate">{{ num_sources|intcomma }}</div>
    <div class="text-sm text-muted-foreground border-b border-border pb-2 mb-2 truncate">source{{ num_sources|pluralize }}</div>
    <div class="text-sm truncate"><strong>{{ num_video_sources|intcomma }}</strong> video, <strong>{{ num_audio_sources|intcomma }}</strong> audio</div>
  </a>
  <a href="{% url 'sync:media' %}" class="group rounded-lg border border-border bg-card p-5 text-center hover:border-accent transition-colors">
    <div class="text-3xl font-bold text-foreground truncate">{{ num_media|intcomma }}</div>
    <div class="text-sm text-muted-foreground border-b border-border pb-2 mb-2 truncate">media item{{ num_media|pluralize }}</div>
    <div class="text-sm truncate"><strong>{{ num_downloaded_media|intcomma }}</strong> downloaded</div>
  </a>
  <a href="{% url 'sync:tasks' %}" class="group rounded-lg border border-border bg-card p-5 text-center hover:border-accent transition-colors">
    <div class="text-3xl font-bold text-foreground truncate">{{ num_tasks|intcomma }}</div>
    <div class="text-sm text-muted-foreground border-b border-border pb-2 mb-2 truncate">scheduled task{{ num_tasks|pluralize }}</div>
    <div class="text-sm truncate"><strong>{{ num_completed_tasks|intcomma }}</strong> completed</div>
  </a>
  <a href="{% url 'sync:media' %}" class="group rounded-lg border border-border bg-card p-5 text-center hover:border-accent transition-colors">
    <div class="text-3xl font-bold text-foreground truncate">{{ disk_usage_bytes|bytesformat }}</div>
    <div class="text-sm text-muted-foreground border-b border-border pb-2 mb-2 truncate">{{ disk_usage_bytes|intcomma }} bytes</div>
    <div class="text-sm truncate">Avg. <strong>{{ average_bytes_per_media|bytesformat }}</strong> per media</div>
  </a>
</div>

<!-- Latest & Largest downloads -->
<div class="grid grid-cols-1 lg:grid-cols-2 gap-4 mb-6">
  <div class="rounded-lg border border-border bg-card p-5">
    <h2 class="!pt-0 truncate">Latest downloads</h2>
    <div class="divide-y divide-border">
      {% for media in latest_downloads %}
        <a href="{% url 'sync:media-item' pk=media.pk %}" class="block py-2.5 hover:bg-muted -mx-2 px-2 rounded transition-colors">
          <div class="truncate font-medium">{{ media.name }}</div>
          <div class="truncate text-sm text-muted-foreground"><strong>{{ media.download_date|timesince:now }}</strong> ago from &quot;{{ media.source.name }}&quot;</div>
        </a>
      {% empty %}
        <p class="py-3 text-muted-foreground"><i class="fas fa-info-circle"></i> No media has been downloaded.</p>
      {% endfor %}
    </div>
  </div>
  <div class="rounded-lg border border-border bg-card p-5">
    <h2 class="!pt-0 truncate">Largest downloads</h2>
    <div class="divide-y divide-border">
      {% for media in largest_downloads %}
        <a href="{% url 'sync:media-item' pk=media.pk %}" class="block py-2.5 hover:bg-muted -mx-2 px-2 rounded transition-colors">
          <div class="truncate">{{ media.name }}</div>
          <div class="truncate text-sm text-muted-foreground"><strong>{{ media.downloaded_filesize|bytesformat }}</strong>{% if media.downloaded_format %} in {{ media.downloaded_format }}{% endif %} from &quot;{{ media.source.name }}&quot;</div>
        </a>
      {% empty %}
        <p class="py-3 text-muted-foreground"><i class="fas fa-info-circle"></i> No media has been downloaded.</p>
      {% endfor %}
    </div>
  </div>
</div>

<!-- Runtime information -->
<h2 class="truncate">Runtime information</h2>
<div class="rounded-lg border border-border overflow-hidden">
  <table class="w-full text-sm">
    <tr title="User ID TubeSync is running under" class="border-b border-border">
      <td class="hidden sm:table-cell py-3 px-4 text-muted-foreground font-medium w-1/3">User ID</td>
      <td class="py-3 px-4"><span class="sm:hidden text-muted-foreground">User ID<br></span><strong>{{ uid }}</strong></td>
    </tr>
    <tr title="Group ID TubeSync is running under" class="border-b border-border">
      <td class="hidden sm:table-cell py-3 px-4 text-muted-foreground font-medium w-1/3">Group ID</td>
      <td class="py-3 px-4"><span class="sm:hidden text-muted-foreground">Group ID<br></span><strong>{{ gid }}</strong></td>
    </tr>
    <tr title="Local directory where configuration data is stored" class="border-b border-border">
      <td class="hidden sm:table-cell py-3 px-4 text-muted-foreground font-medium w-1/3">Config directory</td>
      <td class="py-3 px-4"><span class="sm:hidden text-muted-foreground">Config directory<br></span><strong>{{ config_dir }}</strong></td>
    </tr>
    <tr title="Local directory where media will be downloaded to" class="border-b border-border">
      <td class="hidden sm:table-cell py-3 px-4 text-muted-foreground font-medium w-1/3">Downloads directory</td>
      <td class="py-3 px-4"><span class="sm:hidden text-muted-foreground">Downloads directory<br></span><strong>{{ downloads_dir }}</strong></td>
    </tr>
    <tr title="Database connection used by TubeSync">
      <td class="hidden sm:table-cell py-3 px-4 text-muted-foreground font-medium w-1/3">Database</td>
      <td class="py-3 px-4"><span class="sm:hidden text-muted-foreground">Database<br></span><strong>{{ database_connection }}{% if database_filesize %} ({{ database_filesize|bytesformat }}){% endif %}</strong></td>
    </tr>
  </table>
</div>
{% endblock %}
